{% extends 'layout.html' %} {% load static %} {% load extras %} {% block title %}
<title>{{product.name}}</title>{% endblock title %}




{% block main_content %}

<div class="container text-center ">
    <div class="row m-5">
        <div id="carouselExampleIndicators" class="carousel slide" data-mdb-ride="carousel">
            <div class="carousel-indicators">
                <button type="button" data-mdb-target="#carouselExampleIndicators" data-mdb-slide-to="0" class="active"
                    aria-current="true" aria-label="Slide 1"></button>
                <button type="button" data-mdb-target="#carouselExampleIndicators" data-mdb-slide-to="1"
                    aria-label="Slide 2"></button>
                <button type="button" data-mdb-target="#carouselExampleIndicators" data-mdb-slide-to="2"
                    aria-label="Slide 3"></button>
            </div>
            <div class="carousel-inner border-15">
                <div class="carousel-item active">
                    <img src="{{product.image1.url}}" class="d-block w-100" alt="Product Image 1"
                        style="object-fit: cover; aspect-ratio: 1/0.44;" />
                </div>
                <div class="carousel-item">
                    <img src="{{product.image2.url}}" class="d-block w-100" alt="Product Image 2"
                        style="object-fit: cover; aspect-ratio: 1/0.44;" />
                </div>
                <div class="carousel-item">
                    <img src="{{product.image3.url}}" class="d-block w-100" alt="Product Image 3"
                        style="object-fit: cover; aspect-ratio: 1/0.44;" />
                </div>
            </div>
            <button class="carousel-control-prev" type="button" data-mdb-target="#carouselExampleIndicators"
                data-mdb-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-mdb-target="#carouselExampleIndicators"
                data-mdb-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>
        </div>
        <div>
            <div class="row mt-3">
                <div class="col-lg-8 text-center text-lg-start">
                    <div class="d-flex justify-content-between">
                        <h3 class="fs-2 lh-1 mt-1">{{product.name}}</h2>
                            <h3 class="border border-15 text-danger p-2">Rs. {{product.price}}</h3>
                    </div>

                    <div class="d-flex">
                        <a tabindex="0" class="btn btn-primary" role="button" data-mdb-toggle="popover"
                            data-mdb-trigger="focus" data-mdb-content="You can connect with the seller right away!">Free
                            to message</a>
                        <h6 class="mt-2 ms-3">Listed on {{product.date}}</h6>
                    </div>

                    <p class="mt-2"><i class="fas fa-grin-squint"></i> {{product.view_count}} views</p>
                    <hr>
                    <div>
                        <h4 class="mb-3">Our Commitment</h4>
                        <div class="d-flex gap-2">
                            <button type="button"
                                class="btn btn-outline-dark btn-rounded responsive-text text-center w-25"
                                data-mdb-ripple-color="dark">
                                Live chat <i class="fa fa-comment" aria-hidden="true"></i>
                            </button>
                            <button type="button"
                                class="btn btn-outline-dark btn-rounded  responsive-text text-center w-25"
                                data-mdb-ripple-color="dark">
                                Refund policy <i class="fa fa-surprise" aria-hidden="true"></i>
                            </button>
                            <button type="button"
                                class="btn btn-outline-dark btn-rounded  responsive-text text-center w-25"
                                data-mdb-ripple-color="dark">
                                Authorized Seller <i class="fa fa-shield" aria-hidden="true"></i>
                            </button>
                            <button type="button"
                                class="btn btn-outline-dark btn-rounded  responsive-text text-center w-25"
                                data-mdb-ripple-color="dark">
                                Gurenteed product <i class="fa fa-map-marker-check" aria-hidden="true"></i>
                            </button>

                        </div>
                    </div>
                    <hr>
                    <h4>Specification</h4>
                    <div class="d-flex text-muted pt-2 justify-content-between">
                        <p class="fs-5"><i class="fa fa-compass" aria-hidden="true"></i> <strong>
                                Brand:</strong> {{product.brand}}</p>

                        <p class="fs-5"><i class="fa fa-clone" aria-hidden="true"></i> <strong>
                                Category:</strong> {{product.category}}</p>
                        <p class="fs-5"><i class="fa fa-pencil" aria-hidden="true"></i> <strong>
                                Color:</strong> {{product.color}}</p>


                    </div>
                    <div class="d-flex text-muted pt-2 justify-content-between">
                        <p class="fs-5"><i class="fa fa-certificate" aria-hidden="true"></i> <strong>
                                Warrenty:</strong> {{product.warranty}}</p>
                        <h3><span class="badge bg-danger text-white">Quantity: {{product.quantity}}</i></span></h3>

                    </div>

                    <hr>
                    <div>
                        <h4>Description</h4>
                        <p>{{product.description}}
                        </p>
                    </div>
                    <hr>
                    <h4>Product Details Section</h4>
                    <div class="row">
                        <p>{{product.specifications}}</p>
                    </div>

                    <hr>

                    <div class="col-md-10 col-lg-8 col-xl-6 w-100">
                        <div class="card border-15">
                            <div class="card-body">
                                <div class="d-flex flex-start w-100">

                                    <div class="w-100">
                                        <h5>Post your speak!</h5>

                                        <form method="POST">
                                            {% csrf_token %}
                                            <input type="hidden" name="productSno" value="{{product.id}}">
                                            <input type="hidden" name="formType" value="comment">
                                            <input type="hidden" name="commentSno" value="">
                                            <textarea class="form-control" id="comment" name='comment'
                                                placeholder="What is your view?" rows="4"></textarea>

                                            <div class="d-flex justify-content-between mt-3 gap-1">
                                                <p class=" text-nowrap">Comment can be viewed below!</p>
                                                {% if user.is_authenticated %}
                                                <button type="submit" class="btn btn-danger text-nowrap">Send<i
                                                        class="fas fa-long-arrow-alt-right ms-1"></i></button>
                                                {% else %}
                                                <button type="submit" class="btn btn-danger text-nowrap" disabled>Send<i
                                                        class="fas fa-long-arrow-alt-right ms-1"></i></button>

                                                {% endif %}
                                            </div>
                                            {% if not user.is_authenticated %}
                                            <p class="text-muted" style="float:right"> Please login to post comment</p>
                                            {% endif %}
                                        </form>
                                    </div>
                                </div>

                                <div>
                                    <div>
                                        <h5 class="mt-2 text-decoration-underline">Recent Comments</h5>
                                        <h6 class="text-small">{{count}} comments</h6>
                                        {% for c in comments %}
                                        <div class="col-md-12 col-lg-10 col-xl-8 w-100 mb-2">
                                            <div class="card border-15 ">
                                                <div class="card-body">
                                                    <div
                                                        class="d-flex flex-start flex-column align-items-center mb-3  justify-content-between">
                                                        <div
                                                            class="d-flex justify-content-between w-100 align-items-center mb-1">
                                                            <div class="d-flex align-items-center gap-2">
                                                                <img src="{{c.user.profile.profile_pic.url}}" alt="User"
                                                                    style="vertical-align: middle; width: 35px;height: 35px;border-radius: 50%;">
                                                                <h6
                                                                    class="d-flex align-items-center gap-2 fw-bold text-primary mb-1">
                                                                    {{c.user.first_name}} {{c.user.last_name}}</h6>
                                                            </div>

                                                            {% if request.user == c.user %}

                                                            <div class="dropdown">
                                                                <button class="border-0 bg-transparent" type="button"
                                                                    id="dropdownMenuButton1" data-mdb-toggle="dropdown"
                                                                    aria-expanded="false">
                                                                    <i class="fas fa-ellipsis-v"></i>
                                                                </button>
                                                                <ul class="dropdown-menu"
                                                                    aria-labelledby="dropdownMenuButton1">
                                                                    <li><a class="dropdown-item " href="#"><i
                                                                                class="fas fa-edit me-2"></i>
                                                                            Edit</a>
                                                                    </li>
                                                                    <li><a class="dropdown-item" href="#"><i
                                                                                class="fas fa-trash me-2"></i>
                                                                            Delete</a></li>
                                                                    <li><a class="dropdown-item" href="#"><i
                                                                                class="fas fa-flag me-2"></i>Report</a>
                                                                    </li>
                                                                </ul>
                                                            </div>

                                                            {% endif %}

                                                        </div>
                                                        <p class="text-muted small mb-0 me-auto">
                                                            Shared publicly - {{c.timestamp}}
                                                        </p>
                                                    </div>

                                                    <p class="mt-3 mb-2 pb-2 text-start">
                                                        {{c.comment_text}}
                                                    </p>

                                                    <div class="d-flex justify-content-start">


                                                        {% if request.user in c.likes.all %}
                                                        <form action="/product/{{c.sno}}/comment_like" method="POST">
                                                            {% csrf_token %}
                                                            <button
                                                                class=" btn-thumb   border-0 bg-transparent text-primary"
                                                                type=" submit" data-new="{{c.sno}}" id="new"><i
                                                                    class="fas fa-thumbs-up   fs-6 me-2"></i>
                                                            </button>


                                                        </form>

                                                        {% else %}
                                                        <form action="/product/{{c.sno}}/comment_like" method="POST">
                                                            {% csrf_token %}
                                                            <button type=" submit" id="new"
                                                                class=" btn-thumb border-0 bg-transparent "
                                                                data-new="{{c.sno}}"><i
                                                                    class="fas fa-thumbs-up fs-6 me-2 "></i></button>

                                                        </form>
                                                        {% endif %}
                                                        <span class="like-count me-2 ">{{c.likes.all.count}}</span>
                                                        <p class="mb-0">Like</p>


                                                        <a class="d-flex align-items-center me-3 ms-2"
                                                            data-toggle="collapse" href="#replyBox{{c.sno}}"
                                                            role="button" aria-expanded="false"
                                                            aria-controls="replyBox">
                                                            <i class="far fa-comment-dots me-2"></i>
                                                            <p class="mb-0">Reply</p>
                                                        </a>
                                                    </div>

                                                </div>


                                            </div>
                                        </div>
                                        <div class="collapse" id="replyBox{{c.sno}}">
                                            <form method="POST">
                                                {% csrf_token %}
                                                <input type="hidden" name="productSno" value="{{product.id}}">
                                                <input type="hidden" name="formType" value="comment">
                                                <input type="hidden" name="commentSno" value="{{c.sno}}">
                                                <textarea class="form-control" id="comment" name='comment'
                                                    placeholder="Post Reply" rows="4"></textarea>

                                                <div class="d-flex justify-content-between mt-3 gap-1">
                                                    <button type="submit" class="btn btn-danger text-nowrap">Send<i
                                                            class="fas fa-long-arrow-alt-right ms-1"></i></button>
                                                </div>
                                            </form>

                                        </div>
                                        <div>
                                            {% for c in reply|get_val:c.sno %}
                                            <div class="card-body ms-5 mb-2 ">
                                                <div class="d-flex flex-start flex-column align-items-center mb-3">
                                                    <div class="d-flex w-100 justify-content-between">
                                                        <div class="d-flex gap-2">
                                                            <img src="{{c.user.profile.profile_pic.url}}" alt="User"
                                                                style="vertical-align: middle; width: 30px;height: 30px;border-radius: 50%;">
                                                            <h6
                                                                class="d-flex align-items-center gap-2 fw-bold text-primary mb-1">
                                                                {{c.user.first_name}} {{c.user.last_name}}</h6>
                                                        </div>

                                                        {% if request.user == c.user %}

                                                        <div class="dropdown">
                                                            <button class="border-0 bg-transparent" type="button"
                                                                id="dropdownMenuButton1" data-mdb-toggle="dropdown"
                                                                aria-expanded="false">
                                                                <i class="fas fa-ellipsis-v"></i>
                                                            </button>
                                                            <ul class="dropdown-menu"
                                                                aria-labelledby="dropdownMenuButton1">
                                                                <li><a class="dropdown-item " href="#"><i
                                                                            class="fas fa-edit me-2"></i>
                                                                        Edit</a>
                                                                </li>
                                                                <li><a class="dropdown-item" href="#"><i
                                                                            class="fas fa-trash me-2"></i>
                                                                        Delete</a></li>
                                                                <li><a class="dropdown-item" href="#"><i
                                                                            class="fas fa-flag me-2"></i>Report</a>
                                                                </li>
                                                            </ul>
                                                        </div>

                                                        {% endif %}

                                                    </div>
                                                    <p class="text-muted small mb-0 me-auto mt-1">
                                                        Shared publicly - {{c.timestamp}}
                                                    </p>


                                                </div>

                                                <p class="mt-3 mb-2 pb-2 text-start">
                                                    {{c.comment_text}}
                                                </p>

                                                <div class="d-flex justify-content-start">


                                                    {% if request.user in c.likes.all %}
                                                    <form action="/product/{{c.sno}}/comment_like" method="POST">
                                                        {% csrf_token %}
                                                        <button class=" btn-thumb   border-0 bg-transparent"
                                                            type=" submit" data-new="{{c.sno}}" id="new"><i
                                                                class="fas fa-thumbs-up text-primary  fs-6 me-2"></i>
                                                        </button>


                                                    </form>

                                                    {% else %}
                                                    <form action="/product/{{c.sno}}/comment_like" method="POST">
                                                        {% csrf_token %}
                                                        <button type=" submit" id="new"
                                                            class=" btn-thumb border-0 bg-transparent"
                                                            data-new="{{c.sno}}"><i
                                                                class="fas fa-thumbs-up fs-6 me-2 "></i></button>

                                                    </form>
                                                    {% endif %}
                                                    <span class="like-count me-2 ">{{c.likes.all.count}}</span>
                                                    <p class="mb-0">Like</p>



                                                </div>
                                            </div>

                                            {% endfor %}
                                        </div>
                                        {% endfor %}
                                    </div>

                                </div>


                            </div>

                        </div>

                    </div>



                </div>
                <div class="col-md-10 mx-auto col-lg-4 mt-md-0">
                    <div class="p-md-3 rounded-5 border">
                        <div class="d-flex justify-content-around  mt-3 mb-3 ">
                            <img class="img-fluid rounded-circle" src="{{product.seller.profile.profile_pic.url}}"
                                alt="" style="object-fit: cover; height: 100px; width: 100px;">
                            <div class="d-flex flex-column text-center">
                                <a href="/dashboard/profile/{{product.seller.profile.id}}">
                                    <h5 class="fw-bold">{{product.seller.first_name}} {{product.seller.last_name}}</h5>
                                </a>
                                <h6><i class="fa fa-map-marker" aria-hidden="true"></i> Kathmandu</h6>
                                <input type="hidden" name="to_user" id="to_user" value="{{product.seller}}">
                                <button type="button" class="btn btn-outline-success" data-mdb-ripple-color="dark">
                                    🟢 AVAILABLE NOW
                                </button>

                            </div>
                        </div>
                        <form role="form" method="POST">
                            {% csrf_token %}
                            <input type="hidden" name="to_user" id="to_user" value="{{product.seller}}">
                            <input type="hidden" name="formType" value="message">
                            <textarea class="form-control" id="body" rows="4" , name="body"></textarea>
                            <label class="form-label" for="textAreaExample">Message</label>
                            {% if user.is_authenticated and  user != product.seller %}
                            <button type="submit" class="btn btn-success w-100 mt-2">Send free message</button>
                            {% else %}
                            <button type="submit" class="btn btn-success w-100 mt-2" disabled>Send free message</button>
                            {% if user == product.seller%}
                            <p class="text-muted"> You cannot send message to self</p>
                            {% else %}
                            <p class="text-muted"> Please login to send message</p>
                            {% endif %}
                            {% endif %}
                        </form>

                        <!-- <div class="shadow" style="border-radius: 7px;">
                            <p>Pay in Advance</p>
                            <div class="input-group mb-3">
                                <span class="input-group-text">$</span>
                                <input name="amountInput" type="number" id="amount" class="form-control" aria-label="Dollar amount (with dot and two decimal places)">
                            </div>
                            <label for="description">$  </label><input name="amountInput" type="number" id="amount" value="" placeholder="">

                        </div> -->
                        <!-- <div id="smart-button-container" class="shadow">
                            <div>
                                <p class="text-danger fw-bold">Pay in Advance</p>
                                <div style="text-align: center"><input class="form-control p-3"
                                        placeholder="Enter Payment Remark" type="text" name="descriptionInput"
                                        id="description" maxlength="127" value=""></div>
                                <p id="descriptionError" style="visibility: hidden; color:red; text-align: center;">
                                    Please enter a description</p>

                                <div style="text-align: center"><input placeholder="Enter Amount" class="form-control p-3"
                                        name="amountInput" type="number" id="amount" value="{{product.price}}"><span> USD</span></div>
                                <p id="priceLabelError" style="visibility: hidden; color:red; text-align: center;">
                                    Please enter a price</p>
                                <div id="invoiceidDiv" style="text-align: center; display: none;"><label
                                        for="invoiceid"> </label><input name="invoiceid" maxlength="127" type="text"
                                        id="invoiceid" value=""></div>
                                <p id="invoiceidError" style="visibility: hidden; color:red; text-align: center;">Please
                                    enter an Invoice ID</p>
                                <div style="text-align: center; margin-top: 0.625rem;" id="paypal-button-container">
                                </div>
                            </div>

                        </div> -->
                        {% if product.seller.profile.user == request.user %}

                        {% else %}
                        <form class="row shadow p-4 border-15 d-flex justify-content-between mt-3" method="POST">
                            {% csrf_token %}
                            <input type="hidden" name="formType" value="wallet">
                            <div class="col-lg-11 m-auto">
                                <p class="text-danger">Sent money to buy item</p>

                                <div class="mb-3">
                                    <div class="d-flex flex-column  w-100">
                                        

                                        <div class="col-auto d-flex flex-column ">
                                            <label for="exampleInputEmail1" class="form-label mt-2 text-start">Sender </label>
                                            <div class="input-group mb-2">
                                                <div class="input-group-prepend">
                                                    <div class="input-group-text">@</div>
                                                </div>
                                                <input placeholder="$" name="Sender1" readonly class="form-control"
                                                value="{{ request.user.profile.username }}">
                                            </div>
                                        </div>

                                        <div class="col-auto d-flex flex-column ">
                                            <label for="exampleInputEmail1" class="form-label mt-2 text-start">Receiver </label>
                                            <div class="input-group mb-2">
                                                <div class="input-group-prepend">
                                                    <div class="input-group-text">@</div>
                                                </div>
                                                <input type="text" class="form-control" id="inlineFormInputGroup" name="Receiver1"
                                                value="{{product.seller.profile.username}}"
                                                    readonly>
                                            </div>
                                        </div>

                                       
                                    </div>
                                    <div id="emailHelp" class="form-text">
                                        Secure payment gateway between client
                                    </div>
                                </div>

<!-- 
                                <div class="mb-3  text-center">
                                    <label for="exampleInputEmail1" class="form-label">Amount in ($)</label>
                                    <input class="form-control w-75 m-auto" placeholder="$" value="{{product.price}}"
                                        name="amount1" aria-describedby="emailHelp">
                                </div> -->

                                
                                        <div class="col-auto d-flex flex-column ">
                                            <label for="exampleInputEmail1" class="form-label  text-start">Amount in $ </label>
                                            <div class="input-group mb-2">
                                                <div class="input-group-prepend">
                                                    <div class="input-group-text">$</div>
                                                </div>
                                                <input class="form-control w-75 m-auto" placeholder="Enter Amount" value=""
                                        name="amount1" aria-describedby="emailHelp">
                                            </div>
                                        </div>

                                <button class="btn btn-primary w-100" type="submit"> Send <i class="fad fa-paper-plane"></i></button>
                            </div>
                            <!-- <div class="col-lg-4 ">
                            <img src="{% static 'images/plane.png' %}" alt="" id="houseimg">
                        </div> -->

                        </form>
                        {% endif %}


                    </div>
                </div>
            </div>
        </div>


    </div>
    <hr>
    <div class="">
        <div class="section-title mb-2">
            <p class="text-center fs-3 fw-bold text-danger">You may like</p>

        </div>
        <div class="row row-cols-2 row-cols-md-3 row-cols-lg-5 justify-content-around">
            {% for i in recommended_products %}
            <div class="box col">
                <div class="card border ">
                    <div class="card-img-top position-relative">
                        <img src="{{i.picture.url}}" alt="" class="card-image rounded-3" />

                        <div class="card-head position-absolute w-100 h-100 top-0">
                            <form action="/product/{{i.id}}/like" method="POST">
                                
                                {% csrf_token %}
                                {% if request.user in i.product_likes.all %}

                                <button type=" submit"
                                    class="product-like-btn border-0 rounded-circle d-flex justify-content-center align-items-center bg-white me-2 mt-2 end-0 position-absolute text-danger"
                                    data-new="{{i.id}}"><i class="fas fa-heart my-2 mx-2 "
                                        data-new="{{i.id}}"></i></button>

                                {% else %}

                                <button type=" submit"
                                    class="product-like-btn border-0 rounded-circle d-flex justify-content-center align-items-center bg-white me-2 mt-2 end-0 position-absolute"
                                    data-new="{{i.id}}"><i class="fas fa-heart my-2 mx-2 "
                                        data-new="{{i.id}}"></i>
                                </button>

                                {% endif %}
                            </form>

                            <a class="btn position-absolute w-100 text-white buyNow-btn start-0 bottom-0 r-paragraph btn-danger"
                                href="/product/details/{{i.id}}">
                                View More
                            </a>
                        </div>
                    </div>
                    <a href="/product/details/{{pro.id}}" class="unlink">
                        <div class="m-3">
                            <strong class="m-1 fs-5  d-flex justify-content-start">{{i.name}}</strong>
                            <div class="d-flex justify-content-between">
                                <span class="text-nowrap r-paragraph ms-1 text-black-50"><i class="fas fa-eye"></i>
                                    <strong>{{i.view_count}}</strong></span>
                                <strong class="text-nowrap r-paragraph text-danger">NPR. {{i.price}}</strong>
                            </div>
                            <hr class="dropdown-divider">
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="text-nowrap r-paragraph">Seller: {{i.seller.first_name}}</span>
                                <span class="text-nowrap r-paragraph">{{i.date}}</span>
                            </div>

                            
                        </div>
                    </a>

                </div>
            </div>
            {% endfor %}

        </div>
    </div>
</div>





{% endblock main_content %}

{% block js_files %}
<script src="{% static 'javascript/like_toggle.js' %}"></script>

<script
    src="https://www.paypal.com/sdk/js?client-id=AYdanYvatISjosyThdFiio_A3UpFBvkN_uOlp_XAVeUEF982LZB1DTVOs4gU85thOdWTF7Ae_3NudXVS&enable-funding=venmo&currency=USD"
    data-sdk-integration-source="button-factory"></script>
<script>
    function initPayPalButton() {
        var description = document.querySelector('#smart-button-container #description');
        var amount = document.querySelector('#smart-button-container #amount');
        var descriptionError = document.querySelector('#smart-button-container #descriptionError');
        var priceError = document.querySelector('#smart-button-container #priceLabelError');
        var invoiceid = document.querySelector('#smart-button-container #invoiceid');
        var invoiceidError = document.querySelector('#smart-button-container #invoiceidError');
        var invoiceidDiv = document.querySelector('#smart-button-container #invoiceidDiv');

        var elArr = [description, amount];

        if (invoiceidDiv.firstChild.innerHTML.length > 1) {
            invoiceidDiv.style.display = "block";
        }

        var purchase_units = [];
        purchase_units[0] = {};
        purchase_units[0].amount = {};

        function validate(event) {
            return event.value.length > 0;
        }

        paypal.Buttons({
            style: {
                color: 'blue',
                shape: 'pill',
                label: 'pay',
                layout: 'horizontal',
                tagline: true
            },

            onInit: function (data, actions) {
                actions.disable();

                if (invoiceidDiv.style.display === "block") {
                    elArr.push(invoiceid);
                }

                elArr.forEach(function (item) {
                    item.addEventListener('keyup', function (event) {
                        var result = elArr.every(validate);
                        if (result) {
                            actions.enable();
                        } else {
                            actions.disable();
                        }
                    });
                });
            },

            onClick: function () {
                if (description.value.length < 1) {
                    descriptionError.style.visibility = "visible";
                } else {
                    descriptionError.style.visibility = "hidden";
                }

                if (amount.value.length < 1) {
                    priceError.style.visibility = "visible";
                } else {
                    priceError.style.visibility = "hidden";
                }

                if (invoiceid.value.length < 1 && invoiceidDiv.style.display === "block") {
                    invoiceidError.style.visibility = "visible";
                } else {
                    invoiceidError.style.visibility = "hidden";
                }

                purchase_units[0].description = description.value;
                purchase_units[0].amount.value = amount.value;

                if (invoiceid.value !== '') {
                    purchase_units[0].invoice_id = invoiceid.value;
                }
            },

            createOrder: function (data, actions) {
                return actions.order.create({
                    purchase_units: purchase_units,
                });
            },

            onApprove: function (data, actions) {
                return actions.order.capture().then(function (orderData) {

                    // Full available details
                    console.log('Capture result', orderData, JSON.stringify(orderData, null, 2));

                    // Show a success message within this page, e.g.
                    const element = document.getElementById('paypal-button-container');
                    element.innerHTML = '';
                    element.innerHTML = '<h3>Thank you for your payment!</h3>';

                    // Or go to another URL:  actions.redirect('thank_you.html');

                });
            },

            onError: function (err) {
                console.log(err);
            }
        }).render('#paypal-button-container');
    }
    initPayPalButton();
</script>

{% endblock js_files %}